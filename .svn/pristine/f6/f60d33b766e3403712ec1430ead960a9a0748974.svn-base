import React, { useState } from 'react';
import Box from '@mui/material/Box';
import Modal from '@mui/material/Modal';
import CartTable from '../cart-table';
import { Header, StyledTitle, StyledMoneyText, TableContainer, FlexContainer, SummaryContainer, RightContainer, DetailContainer, 
  DetailText, PinContainer, StyledTextField, StyledButton, StyledClearIcon } from './confirmation-modal.styled'

const style = {
  position: 'absolute',
  top: '50%',
  left: '50%',
  transform: 'translate(-50%, -50%)',
  width: '91%',
  height: '85%',
  bgcolor: 'background.paper',
  border: '2px solid #000',
  borderRadius: '4px',
  boxShadow: 24,
};

export default function BasicModal({open, setOpen, selectedProducts, employee, balance, companyBranchId}) {
  const [pinValue, setPinValue] = useState('')
  const handleClose = () => setOpen(false);

  const handlePinChange = (value)=>{
    if(value.length > 4) return
    setPinValue(value)
  }

  const handleConfirm = () => {

    const orderProducts = selectedProducts.map(product => {
      return {
        cashOrCardValue: 0,
        catalogId: product.catalogId,
        combo: product.combo,
        deliveryDate: product.deliveryDate,
        deliveryTypeId: product.deliveryTypeId,
        itemId: product.id,
        orderReason: '',
        providerId: product.providerId,
        quantity: product.quantity,
        sections: product.sections,
        subTotal: product.price,
        userType: product.userType
      }
    })
    const payload = {
      id: employee.id,
      nameUser: employee.name,
      paymentMethod: '1',
      pin: pinValue,
      products: orderProducts,
      selectedCompanyBranchId: companyBranchId,
      vendorId: 2829
    }

    console.log(payload)
  }

  return (
    <div>
      <Modal
        open={open}
        onClose={handleClose}
      >
        <Box sx={style}>
          <FlexContainer>
            <RightContainer>
              <Header>
                <StyledTitle>{employee.name}</StyledTitle>
                <StyledMoneyText>{`RD$ ${balance}`}</StyledMoneyText>
              </Header>
              <TableContainer>
                <CartTable selectedProducts={selectedProducts} balance={balance}/>
              </TableContainer>
            </RightContainer>
            <SummaryContainer>
              <StyledClearIcon onClick={handleClose}/>
              <DetailContainer>
                <DetailText>
                  Subtotal
                </DetailText>
                <DetailText>
                  RD $262.00
                </DetailText>
              </DetailContainer>
              <DetailContainer>
                <DetailText>
                  ITBIS(18%) 
                </DetailText>
                <DetailText>
                  RD $46.02
                </DetailText>
              </DetailContainer>
              <DetailContainer>
                <DetailText textColor='#6ec4e8'>
                  Subsidio
                </DetailText>
                <DetailText textColor='#6ec4e8'>
                  RD $302.08
                </DetailText>
              </DetailContainer>
              <DetailContainer>
                <DetailText bold>
                  Total
                </DetailText>
                <DetailText bold>
                  RD $0.00
                </DetailText>
              </DetailContainer>
              <PinContainer>
                <DetailText bold>
                    Digitar Pin
                  </DetailText>
                  <StyledTextField variant="outlined" type='password' value={pinValue} onChange={(e)=>handlePinChange(e.target.value)}
                    inputProps={{
                      style: {fontSize: 24} 
                    }}
                  />
                  <StyledButton onClick={handleConfirm} variant='contained'>
                    Confirmar
                  </StyledButton>
                </PinContainer>
            </SummaryContainer>
          </FlexContainer>
        </Box>
      </Modal>
    </div>
  );
}